function initFeedback(){if(!window.FeedbackScriptOptions){console.log("Feedback not initialized. FeedbackScriptOptions not found");return}gdFbk.init({apiUrl:FeedbackScriptOptions.ApiUrl,templatesUrl:FeedbackScriptOptions.TemplatesUrl,lang:FeedbackScriptOptions.Lang,appName:FeedbackScriptOptions.AppName,theme:FeedbackScriptOptions.Theme,btnPosition:FeedbackScriptOptions.BtnPosition})}var gdFbk={ver:"4.1",templatesUrl:"",apiUrl:"",lang:"",appName:"",theme:null,btnPosition:null,nextSendLimitSeconds:20,isLoaded:!1,settings:null,storage:null,rateField$:null,txtField$:null,popup$:null,placeholder$:null,file:null,getPopupTemplate:function(){return gdFbk.theme&&gdFbk.theme!=""?"/feedback-"+gdFbk.theme+".html?v="+gdFbk.ver:"/feedback.html?v="+gdFbk.ver},getBodyTemplate:function(){return"/feedback-body.html?v="+gdFbk.ver},init:function(options){if(!options.lang||!options.apiUrl||!options.templatesUrl||!options.appName)throw new Error("Feedback - wrong init options passed");gdFbk.lang=options.lang;gdFbk.apiUrl=options.apiUrl;gdFbk.templatesUrl=options.templatesUrl;gdFbk.appName=options.appName;gdFbk.theme=options.theme;gdFbk.btnPosition=options.btnPosition&&options.btnPosition!==""?options.btnPosition:"default";gdFbk.loadStorage();gdFbk.onDomReady(function(){gdFbk.getSettings().then(function(resp){resp.json().then(function(settings){gdFbk.settings=settings;gdFbk.loadPopup()})})})},setFile:function(folderName,fileName,password){if(!folderName){gdFbk.file=null;return}gdFbk.file={folder_name:folderName};fileName&&(gdFbk.file.file_name=fileName);password&&(gdFbk.file.password=password)},setFileFromUrl:function(){const urlParams=new URLSearchParams(window.location.search),urlParamsLowered=new URLSearchParams;for(const urlParam of urlParams)urlParamsLowered.append(urlParam[0].toLowerCase(),urlParam[1]);let fileName=urlParamsLowered.get("filename"),folderName=urlParamsLowered.get("foldername");if(fileName||(fileName=urlParamsLowered.get("firstfilename")),!fileName||!folderName){const file=urlParamsLowered.get("file");if(file&&file.indexOf("/")>0){const fileParts=file.split("/");fileParts.length===2&&(folderName=fileParts[0],fileName=fileParts[1])}}fileName&&folderName&&gdFbk.setFile(folderName,fileName)},loadStorage:function(){let storageData=localStorage.getItem("fbk_"+gdFbk.appName);storageData||(storageData="{}",localStorage.setItem("fbk_"+gdFbk.appName,storageData));gdFbk.storage=JSON.parse(storageData)},saveStorage:function(){localStorage.setItem("fbk_"+gdFbk.appName,JSON.stringify(gdFbk.storage))},open:function(){gdFbk.popup$.classList.add("gd-fbk-popup--visible");gdFbk.isLoaded?gdFbk.updateBodyState():gdFbk.loadBody()},close:function(){gdFbk.popup$.classList.remove("gd-fbk-popup--visible")},loadPopup:function(){gdFbk.getPopup().then(function(resp){resp.text().then(function(html){const localizedHtml=gdFbk.localize(html,gdFbk.settings.localization_strings),rootEl=gdFbk.getRootEl();rootEl.insertAdjacentHTML("beforeend",localizedHtml);gdFbk.initPopupControls()})})},loadBody:function(){gdFbk.getBody().then(function(resp){resp.text().then(function(html){gdFbk.placeholder$.innerHTML=gdFbk.localize(html,gdFbk.settings.localization_strings);gdFbk.initBodyHandlers();gdFbk.isLoaded=!0;gdFbk.isSended()&&gdFbk.showStep("thank")})})},getRootEl:function(){var el=document.querySelector(".gd-root");return el?el:document.body},isSended:function(){if(!gdFbk.storage)return!1;const lastSendDate=gdFbk.storage.lastSend;return lastSendDate?Date.now()-lastSendDate<1e3*gdFbk.nextSendLimitSeconds:!1},localize:function(value,textsObj){let html=value;for(const key in textsObj)html=html.replace("#"+key+"#",textsObj[key]);return html},initPopupControls:function(){gdFbk.popup$=document.querySelector("#gd_fbk_popup");gdFbk.placeholder$=document.querySelector("#gd_fbk_placeholder");document.querySelector("#gd_fbk_popup_btn").addEventListener("click",gdFbk.close);document.querySelector("#gd_fbk_popup_back").addEventListener("click",gdFbk.close);document.querySelector("#gd_fbk_btn").addEventListener("click",gdFbk.open);gdFbk.btnPosition&&document.querySelector("#gd_fbk_btn").classList.add("gd-fbk-open-btn--"+gdFbk.btnPosition)},initBodyHandlers:function(){document.querySelectorAll(".js-fbk-rates>li").forEach(function(rate){rate.addEventListener("click",function(){gdFbk.rateClicked(rate.dataset.rate)})});document.querySelector("#gd_fbk_send").addEventListener("click",function(){gdFbk.showStep("thank")});document.querySelector("#gd_fbk_skip").addEventListener("click",gdFbk.sendClicked);document.querySelector("#gd_fbk_send").addEventListener("click",gdFbk.sendClicked);document.querySelector("#gd_fbk_close").addEventListener("click",gdFbk.close);gdFbk.rateField$=document.querySelector("#gd_fbk_rate_val");gdFbk.txtField$=document.querySelector("#gd_fbk_txt");gdFbk.updateBodyState()},updateBodyState:function(){const fileSending$=document.querySelector("#gd_fbk_send_file");if(fileSending$){document.querySelector("#gd_fbk_send_file_cbx").checked=!1;const fileSending$=document.querySelector("#gd_fbk_send_file");gdFbk.file?fileSending$.classList.remove("gd-fbk-hidden"):fileSending$.classList.add("gd-fbk-hidden")}},getSettings:function(){return fetch(gdFbk.apiUrl+"/settings?lang="+gdFbk.lang)},getBody:function(){return fetch(gdFbk.templatesUrl+gdFbk.getBodyTemplate())},getPopup:function(){return fetch(gdFbk.templatesUrl+gdFbk.getPopupTemplate())},rateClicked:function(rateName){gdFbk.rateField$.value=rateName;rateName==="good"?(gdFbk.sendData(),gdFbk.showStep("thank")):(gdFbk.showStep("form"),gdFbk.txtField$.focus())},sendClicked:function(){gdFbk.sendData();gdFbk.showStep("thank")},showStep:function(name){document.querySelectorAll(".js-fbk-step").forEach(function(step){step.classList.add("gd-fbk-hidden")});document.querySelector("#gd_fbk_"+name).classList.remove("gd-fbk-hidden")},sendData:function(){const url=window.location.href,text=gdFbk.txtField$.value,rate=gdFbk.rateField$.value,sendFileCbx$=document.querySelector("#gd_fbk_send_file_cbx"),appName=gdFbk.appName,data={rate:rate,url:url,text:text,app_name:appName};gdFbk.file&&sendFileCbx$&&sendFileCbx$.checked&&(data.file=gdFbk.file);fetch(gdFbk.apiUrl,{method:"post",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify(data)}).then(function(){gdFbk.clearFields();gdFbk.storage.lastSend=Date.now();gdFbk.saveStorage()})},clearFields:function(){gdFbk.rateField$.value="";gdFbk.txtField$.value=""},onDomReady:function(clbk){document.readyState!=="loading"?setTimeout(clbk,100):document.addEventListener("DOMContentLoaded",clbk)}};gdFbk.onDomReady(initFeedback);